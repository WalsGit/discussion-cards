(()=>{var t={n:a=>{var s=a&&a.__esModule?()=>a.default:()=>a;return t.d(s,{a:s}),s},d:(a,s)=>{for(var i in s)t.o(s,i)&&!t.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:s[i]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.core.compat.app;var s=t.n(a);function i(t,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},i(t,a)}function r(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,i(t,a)}const e=flarum.core.compat["admin/app"];var n=t.n(e);const l=flarum.core.compat["admin/components/ExtensionPage"];var o=t.n(l);const d=flarum.core.compat["admin/components/UploadImageButton"];var c=t.n(d),g=function(t){function a(){return t.apply(this,arguments)||this}r(a,t);var s=a.prototype;return s.content=function(){return m("div",{className:"DiscussionCardsSettings"},m("div",{className:"container"},m("div",{className:"DiscussionCardsSettings--content"},m("h3",null,n().translator.trans("walsgit_discussion_cards.admin.settings.general.where_title")),m("p",{className:"helpText"},n().translator.trans("walsgit_discussion_cards.admin.settings.general.where_info")),m("div",{className:"Section"},this.buildSettingComponent({type:"flarum-tags.select-tags",setting:"walsgit_discussion_cards_allowedTags",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.allowedTags_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.allowedTags_help"),options:{requireParentTag:!1}}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_onIndexPage",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.onIndexPage_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.onIndexPage_help")})),m("h3",null,n().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCardOptions_title")),m("p",{className:"helpText"},n().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCardOptions_info")),m("div",{className:"Section"},this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_primaryCards",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCards_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCards_help"),min:0,step:1,placeholder:4}),this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_desktopCardWidth",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.desktopCardWidth_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.desktopCardWidth_help"),min:10,max:100,step:1,placeholder:49}),this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_tabletCardWidth",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.tabletCardWidth_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.tabletCardWidth_help"),min:10,max:100,step:1,placeholder:49})),m("h3",null,n().translator.trans("walsgit_discussion_cards.admin.settings.general.cardOptions_title")),m("p",{className:"helpText"},n().translator.trans("walsgit_discussion_cards.admin.settings.general.cardOptions_info")),m("div",{className:"Section"},m("div",{className:"DC-DefaultImageSettings"},m("h4",null,n().translator.trans("walsgit_discussion_cards.admin.settings.general.defaultImage_title")),m("p",{className:"helpText"},n().translator.trans("walsgit_discussion_cards.admin.settings.general.defaultImage_info")),null===n().forum.attribute("walsgitDiscussionCardsDefaultImage")?m("div",{className:"imgStub"}):m("img",{className:"DC-UserUploadedImage",src:n().forum.attribute("baseUrl")+"/assets/"+n().forum.attribute("walsgitDiscussionCardsDefaultImage")}),m(c(),{name:"walsgit_discussion_cards_default_image",class:"DC-UploadImageBtn"})),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_previewText",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.previewText_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.previewText_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showAuthor",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showAuthor_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showAuthor_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showReplies",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showReplies_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showReplies_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showBadges",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showBadges_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showBadges_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_markReadCards",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.markReadCards_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.markReadCards_help")})),m("h3",null,n().translator.trans("walsgit_discussion_cards.admin.settings.general.otherOptions_title")),m("p",{className:"helpText"},n().translator.trans("walsgit_discussion_cards.admin.settings.general.otherOptions_info")),m("div",{className:"Section"},m("h4",null,"If ",m("a",{href:"https://flarum.org/extension/flarumite/simple-discussion-views",target:"_blank",rel:"noopener noreferrer"},"Flarumite Simple Discussion Views")," is installed & activated"),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showViews",label:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_label"),help:n().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_help")})),this.submitButton())))},s.onsubmit=function(){var t=Number(this.setting("walsgit_discussion_cards_primaryCards")()),a=Number(this.setting("walsgit_discussion_cards_desktopCardWidth")()),s=Number(this.setting("walsgit_discussion_cards_tabletCardWidth")());return t<0||isNaN(t)?(n().alerts.show({type:"error"},n().translator.trans("walsgit_discussion_cards.admin.errors.primaryCards")),!1):a<10||a>100||isNaN(a)?(n().alerts.show({type:"error"},n().translator.trans("walsgit_discussion_cards.admin.errors.desktopCardWidth")),!1):!(s<10||s>100||isNaN(s))||(n().alerts.show({type:"error"},n().translator.trans("walsgit_discussion_cards.admin.errors.tabletCardWidth")),!1)},s.saveSettings=function(a){if(this.onsubmit()){var s=this.dirty();t.prototype.saveSettings.call(this,a).then((function(){var t={};for(var a in s){var i=a.replace("walsgit_discussion_cards_","");t["walsgitDiscussionCards"+(i=i.replace(/^./,i.charAt(0).toUpperCase()))]=s[a]}n().forum.pushAttributes(t)})).catch((function(t){console.error(t)}))}},a}(o());const u=flarum.core.compat.extend,p=flarum.core.compat["common/Model"];var h=t.n(p);const _=flarum.core.compat["common/components/Button"];var b=t.n(_);flarum.core.compat["common/helpers/icon"];const w=flarum.core.compat["tags/models/Tag"];var f=t.n(w);const C=flarum.core.compat["tags/components/EditTagModal"];var y=t.n(C);const v=flarum.core.compat["common/components/Modal"];var N=t.n(v);const S=flarum.core.compat["common/utils/Stream"];var D=t.n(S),W={},T=function(t){function a(){return t.apply(this,arguments)||this}r(a,t);var s=a.prototype;return s.oninit=function(a){t.prototype.oninit.call(this,a),this.tagSettings=JSON.parse(this.attrs.model.data.attributes.walsgitDiscussionCardsTagSettings||null)||{},W={primaryCards:app.forum.data.attributes.walsgitDiscussionCardsPrimaryCards,desktopCardWidth:app.forum.data.attributes.walsgitDiscussionCardsDesktopCardWidth,tabletCardWidth:app.forum.data.attributes.walsgitDiscussionCardsTabletCardWidth},this.tagSettings.hasOwnProperty("primaryCards")&&null!==this.tagSettings.primaryCards||(this.tagSettings.primaryCards=W.primaryCards),this.tagSettings.hasOwnProperty("desktopCardWidth")&&null!==this.tagSettings.desktopCardWidth||(this.tagSettings.desktopCardWidth=W.desktopCardWidth),this.tagSettings.hasOwnProperty("tabletCardWidth")&&null!==this.tagSettings.tabletCardWidth||(this.tagSettings.tabletCardWidth=W.tabletCardWidth),this.tagSettings.primaryCards=D()(this.tagSettings.primaryCards),this.tagSettings.desktopCardWidth=D()(this.tagSettings.desktopCardWidth),this.tagSettings.tabletCardWidth=D()(this.tagSettings.tabletCardWidth)},s.className=function(){return"WdcTagSettingsModal Modal--large"},s.title=function(){return[app.translator.trans("walsgit_discussion_cards.admin.tag_modal.title"),m("span",{className:"TagLabel colored",style:"--tag-bg: "+this.attrs.model.data.attributes.color+";"},m("span",{className:"TagLabel-text"},m("span",{className:"TagLabel-name"},this.attrs.model.data.attributes.name)))]},s.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"Form"},m("p",null,app.translator.trans("walsgit_discussion_cards.admin.tag_modal.intro_text")),m("div",{className:"Form-group"},m("label",{htmlFor:"primaryCards"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.primaryCards_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.primaryCards_help",{default:W.primaryCards})),m("input",{type:"number",name:"primaryCards",className:"FormControl DC-Number",bidi:this.tagSettings.primaryCards})),m("div",{className:"Form-group"},m("label",{htmlFor:"desktopCardWidth"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.desktopCardWidth_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.desktopCardWidth_help",{default:W.desktopCardWidth})),m("input",{type:"number",name:"desktopCardWidth",className:"FormControl DC-Number",bidi:this.tagSettings.desktopCardWidth})),m("div",{className:"Form-group"},m("label",{htmlFor:"tabletCardWidth"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.tabletCardWidth_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.tabletCardWidth_help",{default:W.tabletCardWidth})),m("input",{type:"number",name:"tabletCardWidth",className:"FormControl DC-Number",bidi:this.tagSettings.tabletCardWidth})),m(b(),{type:"submit",className:"Button Button--primary",loading:this.loading,disabled:this.changed()},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.submit_button"))))]},s.changed=function(){var t=JSON.parse(this.attrs.model.data.attributes.walsgitDiscussionCardsTagSettings||"null")||{};return function(t,a){if("object"!=typeof t||"object"!=typeof a)return!1;if(Object.keys(t).length!==Object.keys(a).length)return!1;for(var s in t)if(t.hasOwnProperty(s))if("object"==typeof t[s]&&"object"==typeof a[s]){if(!compareObjects(t[s],a[s]))return!1}else if(t[s]!==a[s])return!1;return!0}(JSON.parse(JSON.stringify(this.tagSettings)),t)},s.onsubmit=function(t){t.preventDefault();var a=parseInt(this.tagSettings.primaryCards());if(isNaN(a)||a<0)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.primaryCards"));else{var s=parseInt(this.tagSettings.desktopCardWidth());if(isNaN(s)||s<10||s>100)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.desktopCardWidth"));else{var i=parseInt(this.tagSettings.tabletCardWidth());if(isNaN(i)||i<10||i>100)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.tabletCardWidth"));else{var r=this.attrs.model;this.tagSettings.primaryCards(a),this.tagSettings.desktopCardWidth(s),this.tagSettings.tabletCardWidth(i);var e=JSON.stringify(this.tagSettings);this.loading=!0,app.request({method:"PATCH",url:app.forum.attribute("apiUrl")+"/tags/"+r.id()+"/tagSettings",body:{data:{tagSettings:e}}}).then((function(){r.data.attributes.walsgitDiscussionCardsTagSettings=e,app.modal.close()}))}}}},a}(N());function O(){return O=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var i in s)({}).hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},O.apply(null,arguments)}const k=flarum.core.compat["common/utils/classList"];var I=t.n(k),x=function(t){function a(a){var s;return(s=t.call(this,a)||this).loading=!1,s.tagId=a.attrs.tagId,s}r(a,t);var s=a.prototype;return s.view=function(a){return this.attrs.loading=this.loading,this.attrs.className=I()(this.attrs.className,"Button"),n().store.data.tags[this.tagId].data.attributes.walsgitDiscussionCardsTagDefaultImage?(this.attrs.onclick=this.remove.bind(this),m("div",null,m("p",null,m("img",{className:"DC-TagDefaultImage",src:"assets/"+n().store.data.tags[this.tagId].data.attributes.walsgitDiscussionCardsTagDefaultImage,alt:"",width:"200px"})),m("p",null,t.prototype.view.call(this,O({},a,{children:n().translator.trans("core.admin.upload_image.remove_button")}))))):(this.attrs.onclick=this.upload.bind(this),t.prototype.view.call(this,O({},a,{children:n().translator.trans("core.admin.upload_image.upload_button")})))},s.upload=function(){var t=this;this.loading||$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(a){var s=new FormData;s.append(t.attrs.name,$(a.target)[0].files[0]),s.append("tagId",t.tagId),t.loading=!0,m.redraw(),n().request({method:"POST",url:t.resourceUrl(),serialize:function(t){return t},body:s}).then(t.success.bind(t),t.failure.bind(t))}))},s.remove=function(){this.loading=!0,m.redraw();var t=new FormData;t.append("tagId",this.tagId),n().request({method:"DELETE",url:this.resourceUrl(),body:t}).then(this.success.bind(this),this.failure.bind(this))},s.resourceUrl=function(){return n().forum.attribute("apiUrl")+"/"+this.attrs.name},s.success=function(t){window.location.reload()},s.failure=function(t){this.loading=!1,m.redraw()},a}(b());s().initializers.add("walsgit/discussion-cards",(function(){f().prototype.WdcDefaultImage=h().attribute("walsgit_discussion_cards_tag_default_image"),(0,u.extend)(y().prototype,"fields",(function(t){var a=this;if(this.tag.id()){var i=JSON.parse(s().forum.attribute("walsgitDiscussionCardsAllowedTags")),r=i.includes(this.tag.id()),e=r?"DC-ActivationBtn Button activated":"DC-ActivationBtn Button Button--primary",n=r?"DC-TagSettings":"DC-TagSettings DC-Hidden",l=r?s().translator.trans("walsgit_discussion_cards.admin.tags.deactivation_button"):s().translator.trans("walsgit_discussion_cards.admin.tags.activation_button");t.add("tag-discussion-cards-options",m("fieldset",{className:"DC-Fieldset"},m("legend",null,s().translator.trans("walsgit_discussion_cards.admin.tags.options_heading")),m(b(),{className:e,icon:"fas fa-border-all",onclick:function(){(r=!r)?i.push(a.tag.id()):i=i.filter((function(t){return t!==a.tag.id()})),s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/walsgit_discussion_cards_tag_update_allowedTags",body:{allowedTags:i}}).then((function(){s().forum.data.attributes.walsgitDiscussionCardsAllowedTags=JSON.stringify(i),s().data.settings.walsgit_discussion_cards_allowedTags=JSON.stringify(i),e=(r=!r)?"DC-ActivationBtn Button activated":"DC-ActivationBtn Button Button--primary",n=r?"DC-TagSettings":"DC-TagSettings DC-Hidden",l=r?s().translator.trans("walsgit_discussion_cards.admin.tags.deactivation_button"):s().translator.trans("walsgit_discussion_cards.admin.tags.activation_button"),m.redraw()}))}},l),m("div",{className:n},m("div",{className:"DC-TagDefaultImageSettings"},m("h4",null,s().translator.trans("walsgit_discussion_cards.admin.tags.defaultImage_title")),m("p",{className:"helpText"},s().translator.trans("walsgit_discussion_cards.admin.tags.defaultImage_info")),m(x,{name:"walsgit_discussion_cards_tag_default_image",className:"DC-UploadTagImageBtn",ariaLabel:"Upload a default image for this tag",tagId:this.tag.id()})),m(b(),{className:"Button Button--primary",icon:"fas fa-border-all",onclick:function(){s().modal.show(T,{model:a.tag})}},s().translator.trans("walsgit_discussion_cards.admin.tags.options_button")))),-20)}})),s().extensionData.for("walsgit-discussion-cards").registerPage(g)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map